# Item 07. 다 쓴 객체 참조를 해제하라

- 자바는 `가비지 컬렉터`를 갖춘 언어로 C, C++처럼 메모리를 직접 관리하는 언어에 비해 편리합니다.
- 이러한 점으로 메모리 관리에 더 이상 신경쓰지 않아도 된다는 오해를 일으킬 수 있지만 절대 그렇지 않습니다.
- 가비지 컬렉션 언어에서는 메모리 누수를 찾는 것이 매우 까다롭습니다.
  - 객체 참조 하나를 살려두면 그 객체뿐 아니라 그 객체가 참조하는 모든 객체를 회수하지 못하는 문제가 발생합니다.

## 해결

- 해결 방법은 매우 간단합니다. 해당 참조 사용이 종료되었을 경우 `null` 처리를 해주면 됩니다.
- `null` 처리는 실수로 인한 참조 시 `NullPointerException`을 발생시켜 오류 또한 쉽게 발견할 수 있습니다.
- 하지만 과도한 `null` 처리는 바람직하지도 않고 코드를 지저분하게 만듭니다.
  - 객체 참조를 `null` 처리하는 일은 예외적인 경우에만 존재해야 합니다.
- 따라서 자기 메모리를 직접 관리하는 클래스인 경우 메모리 누수에 주의하도록 해야 합니다.

## 캐시

- `캐시` 또한 메모리 누수가 발생할 수 있는 경우입니다.
- 캐시는 유효 기간을 정확히 정의하기 어렵기 때문에 시간이 지날수록 엔트리 가치를 떨어뜨리는 방식을 흔히 사용합니다.
- `백그라운드 스레드`를 활용하거나 부수 작업으로 사용하지 않는 엔트리를 정리해주는 동작이 필요합니다.

## 리스너(listener) 혹은 콜백(callback)

- 클라이언트가 콜백을 등록만 하고 명확히 해지하지 않는다면 콜백은 계속 쌓여나갈 것입니다.
- 해결 방법은 콜백을 약한 참조로 저장하면 가바지 컬렉터가 즉시 수거합니다.
  - `WeakHashMap`에 키로 저장하면 됩니다.

## 결론

- 메모리 누수는 직관적으로 파악하기 힘들기에 철저한 코드 리뷰나 힙 프로파일러 같은 디버깅 도구를 동원해야만 발견되기도 합니다.
- 이런 종류의 문제는 예방법을 익혀둬 사전에 미리 방지하는 것이 중요합니다.