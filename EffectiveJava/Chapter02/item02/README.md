# Item 02. 생성자에 매개변수가 많다면 빌더를 고려하라

## 배경

- 정적 팩터리 메서드와 생성자는 선택적 매개변수가 많을 경우 적절히 대응하기 어렵다는 단점을 가지고 있습니다.

## 해결책

- 이를 보완하기 위해 `점층적 생성자 패턴`을 즐겨 사용했지만 여전히 불편함을 존재합니다.
  - 매개변수에 따른 모든 생성자를 일일이 만들어줘야 하는 문제
  - 매개변수 개수가 무수히 많아지면 작성하거나 읽기 어려운 문제, 실수 유발
- 다음으로 활용할 수 있는 대안은 `자바빈즈 패턴`입니다.
  - 매개변수가 없는 생성자로 객체를 만든 후 `setter`를 통해 매개변수의 값을 설정하는 방법입니다.
  - 코드가 증가했지만 인스턴스를 생성하기 편리하고 가독성이 좋은 코드를 생산할 수 있습니다.
  - 하지만 인스턴스 생성을 위해 여러 메서드가 호출되어야 하고 완전한 객체가 생성되기 전까지 일관성이 무너진 상태에 놓이게 됩니다.
  - 디버깅 또한 쉽지 않고 쓰레드 안전성을 위해 추가적인 작업이 필요합니다.
- `빌더 패턴`
  - 필수 매개변수만으로 생성자 혹은 정적 팩터리를 호출해 빌더 객체를 얻은 후 빌더가 제공하는 일종의 세터 메서드들로 선택 매개변수를 설정합니다.
  - 마지막으로 매개변수가 없는 `build`를 호출해 필요한 객체를 얻을 수 있습니다.
  - 빌더의 메서드들은 빌더 자신을 반환하기 때문에 연쇄적으로 호출할 수 있습니다.
  - 이러한 방식을 `플루언트 API(fluent API)` 혹은 `메서드 연쇄(method chaining)`이라 합니다.

## 유연한 빌더 패턴

- 빌더 패턴은 계층적으로 설계된 클래스와 함께 사용하기 좋습니다.
- `추상 클래스`는 `추상 빌더`를 `구체 클래스`는 `구체 빌더`를 갖도록 설계합니다.
- 하위 클래스의 메서드가 상위 클래스의 메서드가 정의한 반환 타입이 아닌 그 하위 타입을 반환하는 기능을 `공변 반환 타이핑`이라 합니다.
  - 클라이언트가 형변환에 신경 쓰지 않고 빌더를 사용할 수 있는 장점이 존재합니다.

## 마무리

- 빌더 패턴은 상당히 유연하다는 장점을 가지고 있습니다.
- 빌더 생성 비용이 크지는 않지만 성능이 민감한 상황에서는 문제가 될 수 있음을 인지해야 합니다.
- 코드가 장황하다는 단점도 있기에 매개변수가 4개 이상일 때 값어치를 할 수 있지만 API는 시간이 지날수록 매개변수가 많아지는 경향이 있기에 빌더 패턴 도입을 권장하고 있습니다.
- 빌더 패턴은 코드를 읽고 쓰기 훨씬 간결해지고 자바빈즈보다 훨씬 안전하다는 장점이 존재합니다.