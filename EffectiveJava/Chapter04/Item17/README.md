# Item 17. 변경 가능성을 최소화하라

- `불변 클래스`란 인스턴스의 내부 값을 수정할 수 없는 클래스이다.
  - 객체가 파괴되는 순간까지 절대 달라지지 않는다.
  - 설계, 구현, 사용이 쉽고 오류가 생길 여지도 적다.

## 클래스를 불변으로 만드는 다섯 가지 규칙

1. 객체의 상태를 변경하는 메서드를 제공하지 않는다.
2. 클래스를 확장할 수 없도록 한다.
3. 모든 필드를 final로 선언한다.
4. 모든 필드를 private으로 선언한다.
   - `public final`로 선언해도 불변 객체는 되지만 다른 곳에서 사용될 여부가 있기에 다음 릴리즈에서 내부 표현을 변경하지 못한다.
5. 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.
   - 생성자, 접근자, readObject에서 방어적 복사가 일어나도록 해야 한다.

## 함수형 프로그래밍

- 피연산자 자체는 그대로인 프로그래밍 패턴을 `함수형 프로그래밍`
- 피연산자 자신을 수정해 자신의 상태가 변하게 되는 것을 `절차적` 혹은 `명령형 프로그래밍`

## 불변 객체의 장점

- 불변 객체는 단순하다.
- 불변 객체는 근본적으로 스레드 안전하여 따로 동기화할 필요 없다.
- 불변 객체는 안심하고 공유할 수 있다.
  - 한번 만든 인스턴스를 최대한 재활용하기를 권한다.
  - 메모리 사용량과 가비지 컬렉션 비용이 줄어든다.
- 불변 객체는 자유롭게 공유할 수 있음은 물론, 불변 객체끼리는 내부 데이터를 공유할 수 있다.
- 값이 다르다면 반드시 독립된 객체로 만들어야 한다.
  - 객체를 완성하기까지 단계가 많고 중간 단계에서 만들어지는 것이 모두 버려진다면 성능적으로 더 문제가 크다.

## 불변 객체의 설계 방법

- 가장 간단한 방법은 `final` 키워드를 사용하는 것이다.
- 유연한 방법은 모든 생성자를 `private` 혹은 `package-private`로 만들고 `public 정적 팩터리 메서드`를 제공하는 것이다.
  - 상속을 불가능하게 만들고, 유연하게 만들 수 있고 객체 캐싱 기능을 추가해 성능도 향상시킬 수 있다.

## 결론

- 클래스를 꼭 필요한 경우가 아니라면 무조건 불변이여야 한다.
  - 장점이 훨씬 많으며 단점은 잠재적 성능 저하뿐이다.
- 모든 클래스를 불변으로 만들 수는 없기에 가변적인 부분을 최소화한다.
  - 합당한 이유가 존재하지 않다면 모든 필드는 `private final`이여야 한다.
